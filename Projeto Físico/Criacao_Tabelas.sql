-----------------------
--CRIACAO DAS TABELAS--
-----------------------

-- CRIA TABELA CONTA
    CREATE TABLE CONTA(
    USERNAME VARCHAR(15),
    SALDO NUMBER(7, 2) DEFAULT 0,
    LOC_PAIS VARCHAR(20),
    LOC_ESTADO VARCHAR(20),
    LOC_CIDADE VARCHAR(20),
    EM_USO NUMBER(1) DEFAULT 0,
    USERNAME_REDE VARCHAR(15),
    CONSTRAINT PK_CONTA PRIMARY KEY (USERNAME),
    CONSTRAINT FK_CONTA_REDE UNIQUE (USERNAME_REDE),
    CONSTRAINT BOOLEAN CHECK (EM_USO IN (0, 1))
);

-- CRIA TABELA AMIGO
CREATE TABLE AMIGO(
    USERNAME1 VARCHAR(15),
    USERNAME2 VARCHAR(15),
    DATA_AMIZADE DATE,
    CONSTRAINT PK_AMIGO PRIMARY KEY (USERNAME1, USERNAME2),
    CONSTRAINT FK_CONTA_AMIGO1 FOREIGN KEY (USERNAME1) REFERENCES CONTA,
    CONSTRAINT FK_CONTA_AMIGO2 FOREIGN KEY (USERNAME2) REFERENCES CONTA
);

-- CRIA TABELA USUARIO
CREATE TABLE USUARIO(
    CODIGO VARCHAR(5),
    CONSTRAINT PK_USUARIO PRIMARY KEY (CODIGO)
);

-- CRIA TABELA TEM_ACESSO
CREATE TABLE TEM_ACESSO(
    USERNAME VARCHAR(15),
    CODIGO VARCHAR(5),
    CONSTRAINT PK_ACESSO PRIMARY KEY (USERNAME, CODIGO),
    CONSTRAINT FK_USUARIO_ACESSO FOREIGN KEY (CODIGO) REFERENCES USUARIO,
    CONSTRAINT FK_CONTA_ACESSO FOREIGN KEY (USERNAME) REFERENCES CONTA
);

-- CRIA TABELA EMPRESA
CREATE TABLE EMPRESA(
    CNPJ VARCHAR(14),
    NOME VARCHAR(20),
    CONSTRAINT PK_EMPRESA PRIMARY KEY (CNPJ),
	CONSTRAINT NOME_NOT_NULL_TABELA CHECK (NOME IS NOT NULL)
);


-- CRIA TABELA APLICATIVO
CREATE TABLE APLICATIVO(
    NOME VARCHAR(20),
    PRECO_ATUAL NUMBER(7,2),
    DATA_LANCAMENTO DATE,
    CNPJ VARCHAR(14),
	TIPO VARCHAR(10),
    CONSTRAINT PK_APLICATIVO PRIMARY KEY (NOME),
    CONSTRAINT FK_APLICATIVO_EMPRESA FOREIGN KEY (CNPJ) REFERENCES EMPRESA,
	CONSTRAINT TIPO_HERANCA CHECK (TIPO IN ('JOGO', 'SOFTWARE')),
	CONSTRAINT PRECO_NOT_NULL CHECK (PRECO_ATUAL IS NOT NULL),
	CONSTRAINT DATA_NOT_NULL CHECK (DATA_LANCAMENTO IS NOT NULL),
	CONSTRAINT CNPJ_NOT_NULL CHECK (CNPJ IS NOT NULL)
);

-- CRIA TABELA CATEGORIA
CREATE TABLE CATEGORIA(
    NOME VARCHAR(20),
    CATEG VARCHAR(20),
    CONSTRAINT PK_CATEGORIA PRIMARY KEY (NOME, CATEG),
    CONSTRAINT FK_APLICATIVO_CATEGORIA FOREIGN KEY (NOME) REFERENCES APLICATIVO
);

-- CRIA TABELA EXPANSAO
CREATE TABLE EXPANSAO(
    NOME_JOGO VARCHAR(5),
	NOME_EXPANSAO VARCHAR(5),
    CONSTRAINT PK_EXPANSAO PRIMARY KEY (NOME_JOGO),
    CONSTRAINT FK_EXPANSAO_JOGO FOREIGN KEY (NOME_JOGO) REFERENCES APLICATIVO
);

-- CRIA TABELA COMPRA
CREATE TABLE COMPRA(
    USERNAME VARCHAR(15),
    NOME VARCHAR(20),
    PRECO_COMPRA NUMBER(7,2),
    DATA_COMPRA DATE,
    CONSTRAINT PK_COMPRA PRIMARY KEY (USERNAME, NOME),
    CONSTRAINT FK_COMPRA_CONTA FOREIGN KEY (USERNAME) REFERENCES CONTA,
    CONSTRAINT FK_COMPRA_APLICATIVO FOREIGN KEY (NOME) REFERENCES APLICATIVO,
	CONSTRAINT PRECO_COMPRA_NOT_NULL CHECK (PRECO_COMPRA IS NOT NULL),
	CONSTRAINT DATA_COMPRA_NOT_NULL CHECK (DATA_COMPRA IS NOT NULL)
);

-- CRIA TABELA HISTORICO_EXEC
CREATE TABLE HISTORICO_EXEC(
    CODIGO_USUARIO VARCHAR(5),
    USERNAME_LOGADO VARCHAR(15),
    NOME_APP VARCHAR(5),
    INICIO DATE,
    FIM DATE,
    CONSTRAINT PK_HISTORICO PRIMARY KEY (CODIGO_USUARIO, USERNAME_LOGADO, NOME_APP, INICIO),
    CONSTRAINT FK_HISTORICO_USUARIO FOREIGN KEY (CODIGO_USUARIO) REFERENCES USUARIO,
    CONSTRAINT FK_HISTORICO_LOGADO FOREIGN KEY (USERNAME_LOGADO) REFERENCES CONTA,
    CONSTRAINT FK_HISTORICO_APLICATIVO FOREIGN KEY (NOME_APP) REFERENCES APLICATIVO
);

-- CRIA TABELA CONQUISTA
CREATE TABLE CONQUISTA(
    NOME_CONQUISTA VARCHAR(20),
    DESCRICAO VARCHAR(100),
    RARIDADE VARCHAR(15),
    CODIGO_USUARIO VARCHAR(5),
    USERNAME_LOGADO VARCHAR(15),
    NOME_APP VARCHAR(5),
    INICIO DATE,
    CONSTRAINT PK_CONQUISTA PRIMARY KEY (NOME_CONQUISTA),
    CONSTRAINT FK_CONQUISTA_HISTORICO FOREIGN KEY (CODIGO_USUARIO, USERNAME_LOGADO, NOME_APP, INICIO) REFERENCES HISTORICO_EXEC,
	CONSTRAINT DESCRICAO_NOT_NULL CHECK (DESCRICAO IS NOT NULL),
	CONSTRAINT RARIDADE_NOT_NULL CHECK (RARIDADE IS NOT NULL),
	CONSTRAINT CODIGO_NOT_NULL CHECK (CODIGO_USUARIO IS NOT NULL),
	CONSTRAINT USERNAME_NOT_NULL CHECK (USERNAME_LOGADO IS NOT NULL),
	CONSTRAINT NOME_NOT_NULL CHECK (NOME_APP IS NOT NULL),
	CONSTRAINT INICIO_NOT_NULL CHECK (INICIO IS NOT NULL)
);
